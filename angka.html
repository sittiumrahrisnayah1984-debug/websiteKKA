<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocokkan Angkanya, Guru Hebat!</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .card {
            width: 100%;
            height: 100%;
            cursor: pointer;
            perspective: 1000px;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            border-radius: 0.75rem; /* rounded-lg */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            border-radius: 0.75rem; /* rounded-lg */
            padding: 1rem;
            text-align: center;
        }
        .card-front {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            border: 4px solid #3730a3; /* indigo-800 */
            user-select: none;
        }
        .card-back {
            background-color: #d1fae5; /* emerald-100 */
            color: #065f46; /* emerald-700 */
            transform: rotateY(180deg);
            border: 4px solid #6ee7b7; /* emerald-300 */
        }
        .card.matched .card-front {
            background-color: #10b981; /* emerald-500 */
            color: white;
            border-color: #059669; /* emerald-600 */
            cursor: default;
            animation: pulse-match 0.5s 1;
        }
        @keyframes pulse-match {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Grid responsif */
        #game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            max-width: 800px;
            width: 100%;
        }
        /* Penyesuaian ukuran kartu untuk mobile */
        @media (max-width: 640px) {
            #game-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.75rem;
            }
            .card-face {
                font-size: 1.25rem; /* text-xl */
            }
            .card-container {
                /* Untuk menjaga rasio aspek kartu (4:3) di mobile */
                aspect-ratio: 3 / 4; 
            }
        }
        @media (min-width: 641px) {
            .card-container {
                aspect-ratio: 1 / 1; 
            }
        }
    </style>
</head>
<body x-data="game()">

    <div id="game-container" class="bg-white p-6 md:p-10 rounded-xl shadow-2xl w-full max-w-4xl flex flex-col items-center">
        <h1 class="text-3xl md:text-4xl font-extrabold text-indigo-700 mb-2 text-center">Cocokkan Angkanya, Guru Hebat!</h1>
        <p class="text-gray-600 mb-6 text-center">Temukan pasangan soal dan jawaban penjumlahan yang sesuai.</p>

        <div class="flex flex-col md:flex-row justify-between w-full mb-6 p-4 bg-indigo-50 rounded-lg shadow-inner">
            <div class="text-lg font-semibold text-indigo-800 mb-2 md:mb-0">
                Waktu Berjalan: <span id="time-display" class="font-bold text-indigo-900">00:00</span>
            </div>
            <div class="text-lg font-semibold text-indigo-800">
                Pasangan Ditemukan: <span id="match-count" class="font-bold text-indigo-900">0</span> / <span id="total-pairs">8</span>
            </div>
        </div>

        <div id="message-area" class="h-10 mb-6 w-full text-center">
            <p id="game-message" class="text-xl font-bold text-red-600"></p>
        </div>

        <div id="game-grid" class="w-full">
            <!-- Kartu akan di-render di sini oleh JavaScript -->
        </div>

        <button id="start-button" onclick="startGame()" class="mt-8 px-8 py-3 bg-indigo-600 text-white text-xl font-bold rounded-full shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105">
            Mulai Permainan
        </button>

    </div>

    <script>
        // Data Pasangan Soal dan Jawaban
        const cardPairsData = [
            { problem: "7 + 6", answer: "13" },
            { problem: "5 + 3", answer: "8" },
            { problem: "9 + 2", answer: "11" },
            { problem: "4 + 1", answer: "5" },
            { problem: "10 + 5", answer: "15" },
            { problem: "1 + 1", answer: "2" },
            { problem: "8 + 8", answer: "16" },
            { problem: "3 + 6", answer: "9" },
        ];

        let cards = [];
        let flippedCards = [];
        let matchedCount = 0;
        let lockBoard = false;
        let startTime = null;
        let timerInterval = null;
        let flipTimeout = null; // Timer untuk batas waktu kartu pertama (5 detik)
        const FLIP_TIMEOUT_MS = 5000; // 5 detik untuk memilih kartu kedua

        let totalPairs = cardPairsData.length;

        // Inisialisasi Game
        function initializeGame() {
            // 1. Membuat daftar kartu lengkap (Soal dan Jawaban)
            cards = [];
            cardPairsData.forEach((pair, index) => {
                // Kartu Soal
                cards.push({
                    id: `card-${index}-problem`,
                    content: pair.problem,
                    matchId: index, // Match ID yang sama untuk pasangan
                    isFlipped: false,
                    isMatched: false,
                    isProblem: true
                });
                // Kartu Jawaban
                cards.push({
                    id: `card-${index}-answer`,
                    content: pair.answer,
                    matchId: index,
                    isFlipped: false,
                    isMatched: false,
                    isProblem: false
                });
            });

            // 2. Mengacak Kartu
            shuffleCards(cards);

            // 3. Reset Status
            flippedCards = [];
            matchedCount = 0;
            lockBoard = false;
            startTime = null;
            clearInterval(timerInterval);
            if (flipTimeout) clearTimeout(flipTimeout); // Hapus timer 5 detik jika ada
            flipTimeout = null;

            document.getElementById('time-display').textContent = '00:00';
            document.getElementById('match-count').textContent = '0';
            document.getElementById('total-pairs').textContent = totalPairs;
            document.getElementById('game-message').textContent = 'Tekan "Mulai Permainan" untuk memulai.';
            document.getElementById('start-button').disabled = false;
            document.getElementById('start-button').classList.remove('hidden');

            // 4. Render Kartu
            renderCards();
        }

        // Fungsi Shuffle (Fisher-Yates)
        function shuffleCards(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Fungsi Render Kartu
        function renderCards() {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = '';
            cards.forEach(card => {
                const cardContainer = document.createElement('div');
                cardContainer.classList.add('card-container'); // Untuk rasio aspek
                cardContainer.innerHTML = `
                    <div id="${card.id}" 
                         class="card ${card.isFlipped ? 'flipped' : ''} ${card.isMatched ? 'matched' : ''}" 
                         data-match-id="${card.matchId}" 
                         data-is-problem="${card.isProblem}"
                         onclick="handleCardClick('${card.id}')">
                        <div class="card-inner">
                            <div class="card-face card-front">
                                <span class="text-4xl">?</span>
                            </div>
                            <div class="card-face card-back">
                                ${card.content}
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(cardContainer);
            });
        }

        // Fungsi Mulai Game
        function startGame() {
            if (startTime) return; // Sudah berjalan

            // Sembunyikan tombol mulai dan hapus pesan
            document.getElementById('start-button').classList.add('hidden');
            document.getElementById('game-message').textContent = 'Ayo mulai mencari pasangan!';

            // Mulai Timer Waktu Total
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        // Fungsi Update Timer
        function updateTimer() {
            if (!startTime) return;
            const elapsed = Date.now() - startTime;
            const totalSeconds = Math.floor(elapsed / 1000);
            const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            document.getElementById('time-display').textContent = `${minutes}:${seconds}`;
        }
        
        // Fungsi yang dipanggil jika waktu 5 detik habis (hanya ada 1 kartu terbuka)
        function cardTimeout() {
            lockBoard = true; // Kunci papan sebentar
            document.getElementById('game-message').textContent = 'âš ï¸ Waktu Habis (5s)! Kartu tertutup kembali. Coba lagi!';
            document.getElementById('game-message').classList.remove('text-red-600');
            document.getElementById('game-message').classList.add('text-orange-600');

            // Tutup kartu yang terbuka (hanya 1)
            flippedCards.forEach(cardData => {
                cardData.isFlipped = false;
                const cardElement = document.getElementById(cardData.id);
                if (cardElement) cardElement.classList.remove('flipped');
            });

            // Reset setelah delay singkat
            setTimeout(() => {
                flippedCards = [];
                lockBoard = false;
                document.getElementById('game-message').textContent = '';
                document.getElementById('game-message').classList.remove('text-orange-600');
                document.getElementById('game-message').classList.add('text-red-600');
            }, 500); // Delay 500ms untuk tampilan visual flip
        }


        // Fungsi Klik Kartu
        function handleCardClick(cardId) {
            // Jangan izinkan klik jika papan terkunci atau game belum dimulai
            if (lockBoard || !startTime) return;

            const cardElement = document.getElementById(cardId);
            const cardData = cards.find(c => c.id === cardId);

            // Jangan klik kartu yang sudah terbuka atau sudah cocok
            if (cardData.isFlipped || cardData.isMatched) return;
            
            // Jika ada flipTimeout yang berjalan, bersihkan dulu (ini mencegah kartu ketiga membatalkan timeout kartu pertama)
            if (flipTimeout) clearTimeout(flipTimeout);

            // Membuka Kartu
            cardData.isFlipped = true;
            cardElement.classList.add('flipped');
            flippedCards.push(cardData);
            
            // Logika Timer dan Cek Pasangan
            if (flippedCards.length === 1) {
                // Kartu pertama dibuka: Mulai timer 5 detik untuk memilih kartu kedua
                document.getElementById('game-message').textContent = 'Pilih kartu kedua... (Batas 5s)';
                flipTimeout = setTimeout(cardTimeout, FLIP_TIMEOUT_MS);
            } else if (flippedCards.length === 2) {
                // Kartu kedua dibuka: Hentikan timer 5 detik, lalu cek kecocokan
                flipTimeout = null; // Tidak perlu clearTimeout karena sudah dicek di awal function
                
                lockBoard = true; // Kunci papan saat mengecek
                checkForMatch();
            }
        }

        // Fungsi Cek Kecocokan
        function checkForMatch() {
            const [card1, card2] = flippedCards;
            
            // Pasangan cocok jika matchId-nya sama DAN jenisnya berbeda (Soal vs Jawaban)
            const isMatch = (card1.matchId === card2.matchId) && 
                            (card1.isProblem !== card2.isProblem);

            if (isMatch) {
                // Cocok! Kartu tetap terbuka
                cardsMatch(card1.id, card2.id);
            } else {
                // Tidak Cocok. Kartu akan menutup kembali setelah 1.5 detik
                cardsMismatch(card1.id, card2.id);
            }
        }

        // Aksi Kartu Cocok
        function cardsMatch(id1, id2) {
            document.getElementById('game-message').textContent = 'ðŸŽ‰ Benar, Guru Hebat!';
            document.getElementById('game-message').classList.remove('text-red-600');
            document.getElementById('game-message').classList.add('text-green-700');
            
            // Tandai sebagai Cocok dan akan tetap terbuka
            const card1 = cards.find(c => c.id === id1);
            const card2 = cards.find(c => c.id === id2);
            card1.isMatched = true;
            card2.isMatched = true;
            
            // Ubah tampilan
            document.getElementById(id1).classList.add('matched');
            document.getElementById(id2).classList.add('matched');

            // Reset status
            flippedCards = [];
            lockBoard = false; // Buka kunci papan
            matchedCount++;
            document.getElementById('match-count').textContent = matchedCount;

            // Cek Kemenangan
            if (matchedCount === totalPairs) {
                endGame();
            } else {
                // Clear message after 1.5s
                setTimeout(() => {
                     document.getElementById('game-message').textContent = '';
                     document.getElementById('game-message').classList.remove('text-green-700');
                     document.getElementById('game-message').classList.add('text-red-600');
                }, 1500);
            }
        }

        // Aksi Kartu Tidak Cocok
        function cardsMismatch(id1, id2) {
            document.getElementById('game-message').textContent = 'ðŸ˜… Coba lagi!';
            document.getElementById('game-message').classList.remove('text-green-700');
            document.getElementById('game-message').classList.add('text-red-600');

            // Batas waktu 1.5 detik untuk melihat kartu sebelum tertutup kembali
            setTimeout(() => {
                // Tutup kartu, kartu menjadi bisa diklik lagi (isFlipped=false)
                const card1 = cards.find(c => c.id === id1);
                const card2 = cards.find(c => c.id === id2);

                if (card1) {
                    card1.isFlipped = false;
                    document.getElementById(id1).classList.remove('flipped');
                }
                if (card2) {
                    card2.isFlipped = false;
                    document.getElementById(id2).classList.remove('flipped');
                }
                
                // Reset
                flippedCards = [];
                lockBoard = false; // Buka kunci papan
                document.getElementById('game-message').textContent = '';

            }, 1500); // 1.5 detik delay
        }

        // Akhir Permainan
        function endGame() {
            clearInterval(timerInterval);
            const finalTime = document.getElementById('time-display').textContent;
            
            // Tampilkan pesan kemenangan
            document.getElementById('game-message').classList.remove('text-red-600');
            document.getElementById('game-message').classList.add('text-green-700');
            document.getElementById('game-message').innerHTML = `
                <div class="text-3xl font-extrabold mb-2">SELAMAT! Anda Hebat!</div>
                <div class="text-xl">Semua pasangan ditemukan dalam waktu <span class="text-indigo-600">${finalTime}</span>!</div>
                <div class="text-lg mt-2">Anda adalah "Guru Teliti Hari Ini"!</div>
            `;
            
            // Tampilkan tombol main lagi
            const startButton = document.getElementById('start-button');
            startButton.textContent = 'Main Lagi!';
            startButton.classList.remove('hidden');
            startButton.onclick = initializeGame;
        }

        // Panggil inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', initializeGame);

    </script>
</body>
</html>
